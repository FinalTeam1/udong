<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>우동행</title>
    <link rel="stylesheet" th:href="@{/css/mainDesign.css}" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        .top{
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        .search-form{
            flex: 1;
        }
        .search-bar{
            display: flex;
            align-items: center;
            height: 40px;
            background-color: #E5E5E5;
            border-radius: 0.375rem;
            padding-left: 15px;
            font-family: 'Freesentation-5Medium';
            white-space: nowrap;
        }
        .category-select{
            font-family: 'Freesentation-3Light';
            margin-left: 10px;
            height: 25px;
        }
        .search-input{
            font-family: 'Freesentation-3Light';
            margin-left: 10px;
            width: 65%;
            height: 25px;
            border: 1px solid #979797;
        }
        .btn-search{
            margin-left: auto;
            margin-right: 10px;
            font-family: 'Freesentation-5Medium';
            font-size: 15px !important;
            padding: 1px 15px 1px 15px !important;
        }
        .btn-create-club{
            margin-left: 25px;
            font-family: 'Freesentation-5Medium' !important;
        }
        .club-list{
            height: 720px;
        }
        .club-one{
            cursor: pointer;
        }
        .club-img{
            width: 100px;
            height: 100px;
            margin-right: 15px;
            border-radius: 3px;
        }
        .p-tag{
            margin: 0px;
        }
        .club-category-name{
            width: 70px;
            text-align: center;
            background-color: #E5E5E5;
            border-radius: 3px;
            font-size: 12px;
            padding: 2px;
            margin-bottom: 7px;
        }
        .club-name{
            font-family: 'Freesentation-7Bold';
            font-size: 16px;
        }
        .club-introduction{
            font-size: 13px;
            margin-bottom: 8px;
        }
        .club-etc{
            font-size: 11px;
            color: #6F6F6F;
        }
        .btn-pagination{
            font-family: 'Freesentation-5Medium' !important;
            font-size: 12px !important;
            padding: 4px 8px 4px 8px !important;
            margin-right: 7px;
        }

    </style>
    <script type="text/javascript">

        var filterCategoryCode = "[[${filter.categoryCode}]]";
        var filterSearchWord = "[[${filter.searchWord}]]";

        $(document).ready(function() {

            $.ajax({
                url: "/club/categoryList",
                success: function(data) {
                    var categorySelect = $('select[name="categoryCode"]');
                    data.forEach(function(category) {

                        var option = $('<option></option>')
                        .attr('value', category.categoryCode)
                        .text(category.categoryName);

                        if(category.categoryCode === filterCategoryCode) {
                            option.attr('selected', 'selected');
                        }

                        categorySelect.append(option);

                    });
                },
                error: function() {
                    alert('모임 주제를 불러오는 데 실패했습니다.');
                }
            })

            var pages = [[${pages}]];
            var paginationDiv = $('#pagination');
            for (var i = 1; i <= pages; i++) {

                var button = $('<button></button>')
                .text(i)
                .addClass('btn btn-udh-blue btn-pagination')
                .attr('onclick', 'selectClubList(' + i + ')');

                paginationDiv.append(button);
            }

        })

    </script>
    <script th:inline="javascript">

        window.onload = function() {
            var message = [[${message}]];
            if (message) {
                alert(message);
            }
        }

    </script>
</head>
<body>

<div th:replace="~{/common/menubar}"></div>

<div class="content" style="padding: 40px;">
    <div class="top">
        <form class="search-form" th:action="@{/club/clubMain}" method="get">
            <div class="search-bar">
                <input type="hidden" name="page" value="1">
                <span>주제</span>
                <select class="category-select" name="categoryCode">
                    <option value="ALL">전체</option>
                </select>
                <span style="margin-left: 50px">모임명 검색</span>
                <input type="text" class="search-input" name="searchWord" placeholder=" 검색어 입력..." th:value="${filter.searchWord}">
                <button type="submit" class="btn btn-udh-silver btn-search">검색</button>
            </div>
        </form>
        <a th:href="@{/club/clubInsertForm}">
            <button type="button" class="btn btn-udh-blue btn-create-club">모임 생성</button>
        </a>
    </div>

    <div class="club-list">
        <hr>
        <div th:each="one : ${clubList}" class="club-one">
            <table>
                <tr class="club-one-line">
                    <td>
                        <img th:src="@{'/uploadFiles/' + ${one.attachment[0].savedName}}" class="club-img">
                    </td>
                    <td>
                        <input type="hidden" th:value="${one.clubNo}">
                        <p th:text="${one.category.categoryName}" class="p-tag club-category-name"></p>
                        <p th:text="${one.clubName}" class="p-tag club-name"></p>
                        <p th:text="${one.introduction}" class="p-tag club-introduction"></p>
                        <p class="p-tag club-etc">
                            <span>&#128100;</span>
                            <span th:text="${one.currentPersonnel}"></span> /
                            <span th:text="${one.maxPersonnel}"></span> 명
                            <span style="margin-left: 7px">|</span>
                            <span th:text="${one.location.eupMyeonDongName}" style="margin-left: 7px"></span>
                        </p>
                    </td>
                </tr>
            </table>
            <hr>
        </div>
    </div>

    <div class="pagination" id="pagination">

    </div>

</div>
<script type="text/javascript">

    function selectClubList(page) {

        var encodedCategoryCode = encodeURIComponent(filterCategoryCode);
        var encodedSearchWord = encodeURIComponent(filterSearchWord);
		window.location.href = "/club/clubMain?page="+page+"&categoryCode="+encodedCategoryCode+"&searchWord="+encodedSearchWord;
	}

    $(document).on('click', '.club-one', function() {
        var clubNo = $(this).find('input').val();
        var url = "/club/clubHome?clubNo=" + clubNo;
        window.location.href = url;
    });

</script>
</body>
</html>