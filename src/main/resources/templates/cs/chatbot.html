<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .chatbot {
            position: fixed;
            bottom: 20px;
            right: 120px;
            width: 60px;
            height: 60px;
            background: #FFFFFF;
            border: none;
            border-radius: 30%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s;
            z-index: 1000;
        }
        .chatbot:hover{
            background: #FFD594;
            transform: translateY(-10px);
        }
        .chatbot img {
            width: 90%;
            height: auto;
        }
        .chatbot-window {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 300px;
            height: 400px;
            border: 1px solid #ccc;
            background-color: white;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        .chatbot-header {
            padding: 10px;
            background-color: #f1f1f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chatbot-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
        }
        .chatbot-input {
            display: flex;
            padding: 10px;
        }
        .chatbot-input input {
            flex-grow: 1;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <button type="button" class="chatbot" onclick="toggleChatbot()">
        <img th:src="@{/img/logo.png}" alt="챗봇">
    </button>

    <div id="chatbot-window" class="chatbot-window" style="display: none;">
        <div class="chatbot-header">
            <h3>AI 챗봇</h3>
            <button onclick="toggleChatbot()">닫기</button>
        </div>
        <div class="chatbot-messages" id="chatbot-messages"></div>
        <div class="chatbot-input">
            <input type="text" id="user-input" placeholder="메시지를 입력하세요...">
            <button onclick="sendMessage()">전송</button>
        </div>
    </div>
</body>
<script>
    function toggleChatbot() {
        var chatbotWindow = document.getElementById("chatbot-window");
        chatbotWindow.style.display = chatbotWindow.style.display === "none" ? "block" : "none";
    }

    function sendMessage() {
        var userInput = document.getElementById("user-input");
        var message = userInput.value;
        if (message.trim() !== "") {
            appendMessage("사용자: " + message);
            userInput.value = "";
            // 서버로 메시지 전송 및 응답 처리
            fetchBotResponse(message);
        }
    }

    function appendMessage(message) {
        var chatbotMessages = document.getElementById("chatbot-messages");
        var messageElement = document.createElement("p");
        messageElement.textContent = message;
        chatbotMessages.appendChild(messageElement);
    }

    function fetchBotResponse(message) {
        fetch('/api/chatbot', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ message: message }),
        })
        .then(response => response.json())
        .then(data => {
            appendMessage("챗봇: " + data.response);
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }
</script>
<script>
    (function(){

        var w=window;

        if(w.ChannelIO){
            return w.console.error("ChannelIO script included twice.");
        }

        var ch=function(){ch.c(arguments);};
        ch.q=[];
        ch.c=function(args){ch.q.push(args);};
        w.ChannelIO=ch;

        function l(){
            if(w.ChannelIOInitialized){return;}
            w.ChannelIOInitialized=true;

            var s=document.createElement("script");
            s.type="text/javascript";
            s.async=true;
            s.src="https://cdn.channel.io/plugin/ch-plugin-web.js";

            var x=document.getElementsByTagName("script")[0];
            if(x.parentNode){x.parentNode.insertBefore(s,x);}
        }

        if(document.readyState==="complete"){
            l();
        }else{
            w.addEventListener("DOMContentLoaded",l);
            w.addEventListener("load",l);
        }
    })();

    ChannelIO('boot', {
      "pluginKey": "d7c974e2-4a72-480b-99ca-b3163df9ade0"
    });
</script> <!--채널톡(테스트)-->
</html>